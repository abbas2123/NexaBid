<div class="p-4 w-full">

  <!-- PAGE HEADER -->
  <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
    <div>
      <h1 class="text-3xl font-bold">Coupon Management</h1>
      <p class="text-gray-500 text-sm">Manage and create discount coupons</p>
    </div>

    <button
  onclick="openCouponModal()"
  class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold flex items-center gap-2 hover:bg-blue-700"
>
      <span class="material-symbols-outlined"></span>
      Create Coupon
    </button>
  </div>

  <!-- COUPON TABLE -->
  <div class="bg-white rounded-xl border shadow overflow-x-auto">
    <table class="min-w-full text-sm">
      <thead class="bg-gray-50 border-b">
        <tr>
          <th class="px-4 py-3 text-left">Code</th>
          <th class="px-4 py-3 text-left">Type</th>
          <th class="px-4 py-3 text-left">Value</th>
          <th class="px-4 py-3 text-left">Expiry</th>
          <th class="px-4 py-3 text-center">User Limit</th>
          <th class="px-4 py-3 text-center">Total Limit</th>
          <th class="px-4 py-3 text-left">Status</th>
          <th class="px-4 py-3 text-right">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y">
        <% if (coupons && coupons.length > 0) { %>
          <% coupons.forEach(c => { %>
            <tr class="hover:bg-gray-50">
              <td class="px-4 py-3 font-semibold"><%= c.code %></td>
              <td class="px-4 py-3 capitalize"><%= c.type %></td>
              <td class="px-4 py-3">
                <%= c.type === 'percent' ? c.value + '%' : '₹' + c.value %>
              </td>
              <td class="px-4 py-3">
                <%= c.expiresAt ? new Date(c.expiresAt).toLocaleDateString() : '—' %>
              </td>
              <td class="px-4 py-3 text-center"><%= c.perUserLimit || '∞' %></td>
              <td class="px-4 py-3 text-center"><%= c.usageLimit || '∞' %></td>
              <td class="px-4 py-3">
                <% if (!c.expiresAt || new Date(c.expiresAt) > new Date()) { %>
                  <span class="text-green-600 font-semibold">Active</span>
                <% } else { %>
                  <span class="text-red-600 font-semibold">Expired</span>
                <% } %>
              </td>
              <td class="px-4 py-3 text-right space-x-2">
                <button class="text-blue-600">Edit</button>
                <button class="text-red-600">Delete</button>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="8" class="text-center py-6 text-gray-500">
              No coupons available
            </td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</div>

<!-- ================= MODAL ================= -->
<div
  id="couponModal"
  class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50"
>
  <div class="bg-white rounded-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">

    <!-- MODAL HEADER -->
    <div class="flex justify-between items-center border-b px-6 py-4">
      <h2 class="text-xl font-bold">Create New Coupon</h2>
      <button onclick="closeCouponModal()" class="text-gray-500 hover:text-black">
        ✕
      </button>
    </div>

    <!-- MODAL BODY -->
    <form method="POST" action="/admin/coupon-management/create" class="p-6 space-y-6">

      <!-- CODE -->
      <div>
        <label class="block text-sm font-medium mb-1">Coupon Code</label>
        <input
          name="code"
          required
          class="w-full border rounded px-4 py-2 uppercase"
          placeholder="SUMMER2025"
        />
      </div>

      <!-- TYPE + VALUE -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1">Discount Type</label>
          <select name="type" class="w-full border rounded px-4 py-2">
            <option value="percent">Percentage (%)</option>
            <option value="flat">Flat Amount (₹)</option>
            <option value="cashback">Cashback</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Discount Value</label>
          <input
            name="value"
            type="number"
            required
            class="w-full border rounded px-4 py-2"
          />
        </div>
      </div>

      <!-- LIMITS -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1">Min Purchase Amount</label>
          <input name="minPurchaseAmount" type="number" class="w-full border rounded px-4 py-2" />
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Max Discount</label>
          <input name="maxDiscount" type="number" class="w-full border rounded px-4 py-2" />
        </div>
      </div>

      <!-- USAGE -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1">Per User Limit</label>
          <input name="perUserLimit" type="number" class="w-full border rounded px-4 py-2" />
        </div>

        <div>
          <label class="block text-sm font-medium mb-1">Total Usage Limit</label>
          <input name="usageLimit" type="number" class="w-full border rounded px-4 py-2" />
        </div>
      </div>

      <!-- EXPIRY -->
      <div>
        <label class="block text-sm font-medium mb-1">Expiry Date</label>
        <input name="expiresAt" type="date" class="w-full border rounded px-4 py-2" />
      </div>

      <!-- ACTIONS -->
      <div class="flex justify-end gap-3 pt-4 border-t">
        <button
          type="button"
          onclick="closeCouponModal()"
          class="px-6 py-2 rounded bg-gray-200"
        >
          Cancel
        </button>
        <button
  type="submit"
  class="px-6 py-2 rounded bg-blue-600 hover:bg-blue-700 text-white font-semibold"
>
  Create Coupon
</button>
      </div>

    </form>
  </div>
</div>

<!-- ================= JS ================= -->
<script>
  function openCouponModal() {
    document.getElementById("couponModal").classList.remove("hidden");
    document.getElementById("couponModal").classList.add("flex");
  }

  function closeCouponModal() {
    document.getElementById("couponModal").classList.add("hidden");
    document.getElementById("couponModal").classList.remove("flex");
  }
</script>