<main class="flex flex-1 justify-center py-8 px-4 sm:px-6 lg:px-8">
  <div class="layout-content-container flex flex-col w-full max-w-3xl flex-1 gap-6">
    <!-- Breadcrumbs -->
    <div class="flex flex-wrap gap-2 text-sm">
      <a class="text-gray-600 dark:text-gray-400 hover:text-blue-600 transition-colors"
        href="/auth/dashboard">Dashboard</a>
      <span class="text-gray-400">/</span>
      <a class="text-gray-600 dark:text-gray-400 hover:text-blue-600 transition-colors" href="/user/tenders">My
        Tenders</a>
      <span class="text-gray-400">/</span>
      <span class="text-gray-900 dark:text-white font-medium">Agreement Upload</span>
    </div>
    <% if (approved===null) { %>
      <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4">
        <p class="font-bold text-yellow-700">Waiting for publisher approval</p>
      </div>

      <% } else if (approved===true) { %>
        <div class="bg-green-50 border border-green-200 rounded-xl p-4">
          <p class="font-bold text-green-700">Agreement Approved</p>
        </div>

        <% } else if (approved===false) { %>
          <div class="bg-red-50 border border-red-200 rounded-xl p-4">
            <p class="font-bold text-red-700">Agreement Rejected</p>
            <p class="text-sm text-red-800">
              <%= remarks || "No remarks provided." %>
            </p>
          </div>
          <% } %>
            <div class="flex flex-col gap-3">
              <h1 class="text-slate-900 dark:text-slate-50 text-3xl sm:text-4xl font-black">
                Upload Signed Contract Agreement
              </h1>

              <p class="text-slate-600 dark:text-slate-400 text-base">
                Please upload the final signed agreement in PDF format (max 10MB).
              </p>
            </div>
            <% if (publisherAgreement) { %>
              <div class="p-4 bg-blue-50 dark:bg-blue-900/30 
              rounded-xl border border-blue-200 dark:border-blue-800">

                <p class="text-sm font-semibold text-blue-700 dark:text-blue-300 mb-2">
                  Publisher Uploaded Agreement
                </p>

                <a href="<%= downloadLink %>" target="_blank" class="inline-flex items-center gap-2 bg-blue-600 text-white 
              px-4 py-2 rounded-lg text-sm font-bold hover:bg-blue-700">
                  <span class="material-symbols-outlined text-base">download</span>
                  Download Agreement PDF
                </a>

              </div>
              <% } %>
                <form action="<%= formAction %>?_csrf=<%= csrfToken %>" method="POST" enctype="multipart/form-data">
                  <input type="hidden" name="_csrf" value="<%= csrfToken %>">

                  <div
                    class="flex flex-col p-4 bg-white dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-800">

                    <div class="flex flex-col items-center gap-6 border-2 border-dashed 
                        border-slate-300 dark:border-slate-700 px-6 py-14 rounded-lg">

                      <span class="material-symbols-outlined text-5xl text-slate-400 dark:text-slate-500">
                        upload_file
                      </span>

                      <p class="text-lg font-bold text-slate-900 dark:text-white">Drag & Drop your PDF here</p>
                      <p class="text-sm text-slate-500 dark:text-slate-400">or click below</p>

                      <input type="file" id="agreementFile" name="agreement" accept="application/pdf" class="hidden" />

                      <label for="agreementFile" class="cursor-pointer bg-slate-100 dark:bg-slate-800 px-4 py-2 
                              rounded-lg text-sm font-bold hover:bg-slate-200 dark:hover:bg-slate-700">
                        Upload Signed Agreement
                      </label>

                      <p id="fileName" class="text-primary text-sm font-semibold"></p>
                    </div>
                  </div>

                  <div class="flex items-center gap-4 bg-primary/10 dark:bg-primary/20 p-4 rounded-lg">
                    <span class="material-symbols-outlined text-primary">info</span>
                    <p class="text-slate-800 dark:text-slate-200 text-sm">
                      After upload, the agreement will be sent for publisher approval.
                    </p>
                  </div>

                  <button type="submit" class="w-full sm:w-auto bg-primary text-white h-12 px-5 rounded-lg 
                   font-bold hover:bg-primary/90 mt-4">
                    Submit Agreement
                  </button>

                </form>
  </div>
</main>

<script>
  document.getElementById("agreementFile").addEventListener("change", (e) => {
    document.getElementById("fileName").innerText =
      "ðŸ“„ " + (e.target.files[0]?.name || "");
  });

  document.querySelector('form[action^="/user"]').addEventListener('submit', function (e) {
    const fileInput = document.getElementById('agreementFile');
    if (!fileInput || !fileInput.files.length) {
      e.preventDefault();
      Swal.fire({ icon: 'error', title: 'Validation Error', text: 'Please select a signed agreement PDF.' });
    }
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
  if (new URLSearchParams(location.search).get("uploaded") === "true") {
    Swal.fire("Agreement Submitted!", "Your signed agreement has been uploaded successfully.", "success");
  }
</script>