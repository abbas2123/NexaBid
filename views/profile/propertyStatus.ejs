<div class="max-w-6xl mx-auto px-4 py-10">

  <h1 class="text-3xl font-bold text-gray-900 mb-6">My Property Submissions</h1>

  <a href="/user/status"
     class="inline-flex items-center gap-2 mb-6 px-4 py-2 rounded-lg bg-gray-100 border hover:bg-gray-200">
     <span class="material-symbols-outlined">arrow_back</span>
     Back
  </a>

  <% if (!properties || properties.length === 0) { %>
    <p class="text-gray-600 mt-10 text-lg">
      You have not submitted any properties yet.
    </p>

  <% } else { %>

  <div class="bg-white shadow-md rounded-lg divide-y">

    <% properties.forEach(p => { %>

      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 p-5">

        <!-- LEFT CONTENT -->
        <div class="space-y-1">

          <p class="text-xl font-semibold text-gray-900"><%= p.title %></p>

          <p class="text-primary font-semibold text-lg">
            <% if (p.isAuction) { %>
              ₹ <%= p.basePrice?.toLocaleString() || '-' %>
            <% } else { %>
              ₹ <%= p.buyNowPrice?.toLocaleString() || '-' %>
            <% } %>
          </p>

          <% if (p.verificationStatus === "approved") { %>
            <span class="px-3 py-1 rounded-full bg-green-100 text-green-700 text-xs font-semibold">
              Approved
            </span>
          <% } else if (p.verificationStatus === "submitted") { %>
            <span class="px-3 py-1 rounded-full bg-yellow-100 text-yellow-700 text-xs font-semibold">
              Submitted
            </span>
          <% } else { %>
            <span class="px-3 py-1 rounded-full bg-red-100 text-red-700 text-xs font-semibold">
              Rejected
            </span>
          <% } %>

          <% if (p.rejectionMessage) { %>
            <p class="text-xs text-red-500 mt-2">
              <b>Reason:</b> <%= p.rejectionMessage %>
            </p>
          <% } %>

        </div>

        <!-- ACTIONS -->
        <!-- ACTIONS -->
<div class="flex flex-col sm:flex-row gap-3">

  <!-- VIEW DETAILS -->
 <a href="/user/property/view/<%= p._id %>"
     class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-800 font-semibold text-sm">
    View Details
  </a>

  <!-- EDIT BUTTON (Show always except rejected without form UPDATE) -->
  <a href="/user/propertyStatus/edit/<%= p._id %>"
     class="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600 font-semibold text-sm">
    Edit Property
  </a>

  <!-- RE-SUBMIT BUTTON (only when rejected) -->
  <% if (p.verificationStatus === "rejected") { %>
    <a href="/properties/create?id=<%= p._id %>"
       class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold text-sm">
      Re-submit
    </a>
  <% } %>
<!-- DELETE PROPERTY -->
<form action="/user/property/delete/<%= p._id %>" method="POST" onsubmit="return confirmDelete(event)">
  <button type="submit"
    class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 font-semibold text-sm">
    Delete
  </button>
</form>
</div>

      </div>

    <% }) %>

  </div>

  <% } %>


  
</div>

<script>
function confirmDelete(event) {
  event.preventDefault();

  Swal.fire({
    title: "Are you sure?",
    text: "This will permanently delete the property.",
    icon: "warning",
    showCancelButton: true,
    confirmButtonColor: "#d33",
    cancelButtonColor: "#3085d6",
    confirmButtonText: "Yes, delete it!"
  }).then((result) => {
    if (result.isConfirmed) {
      event.target.submit();
    }
  });

  return false;
}
</script>