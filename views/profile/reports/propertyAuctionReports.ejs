<div
  class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden bg-background-light dark:bg-background-dark">
  <main class="flex-1 w-full max-w-[1280px] mx-auto px-4 md:px-8 py-8 md:py-12">
    <!-- Header -->
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-2xl md:text-3xl font-black text-gray-900 dark:text-white">
          Property Auction Reports
        </h1>
        <p class="text-gray-500 dark:text-gray-400 mt-1">
          <% if (userRole==='admin' ) { %> Overview of all property auctions and results. <% } else { %> Track your
              property auctions, highest bids, and outcomes. <% } %>
        </p>
      </div>
      <a href="/user/report-management"
        class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg text-sm font-semibold transition-colors">
        Back to Reports
      </a>
    </div>

    <!-- Reports Table -->
    <div
      class="bg-white dark:bg-gray-800 shadow-sm border border-gray-200 dark:border-gray-700 rounded-xl overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm text-gray-500 dark:text-gray-400">
          <thead
            class="bg-gray-50 dark:bg-gray-700/50 text-xs uppercase text-gray-500 dark:text-gray-400 font-bold tracking-wider">
            <tr>
              <th class="px-6 py-4">Property</th>
              <% if (userRole==='admin' ) { %>
                <th class="px-6 py-4">Seller</th>
                <% } %>
                  <th class="px-6 py-4">Highest Bid</th>
                  <th class="px-6 py-4">Winner / Highest Bidder</th>
                  <th class="px-6 py-4">Status</th>
                  <th class="px-6 py-4 text-right">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
            <% if (properties && properties.length> 0) { %>
              <% properties.forEach(prop=> { %>
                <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors">
                  <!-- Property Info -->
                  <td class="px-6 py-4">
                    <div class="flex flex-col">
                      <span class="font-bold text-gray-900 dark:text-white text-base">
                        <%= prop.title %>
                      </span>
                      <span class="text-xs text-gray-400 mt-0.5">
                        <%= prop.address %>
                      </span>
                      <span class="text-xs text-blue-600 mt-1">Ends/Ended: <%= new
                          Date(prop.auctionEndsAt).toLocaleDateString() %></span>
                    </div>
                  </td>

                  <!-- Seller (Admin Only) -->
                  <% if (userRole==='admin' ) { %>
                    <td class="px-6 py-4">
                      <% if (prop.sellerId) { %>
                        <div class="flex flex-col">
                          <span class="font-semibold text-gray-900 dark:text-gray-200">
                            <%= prop.sellerId.name %>
                          </span>
                          <a href="mailto:<%= prop.sellerId.email %>" class="text-xs text-blue-500 hover:underline">
                            <%= prop.sellerId.email %>
                          </a>
                        </div>
                        <% } else { %>
                          <span class="text-gray-400 italic">Unknown</span>
                          <% } %>
                    </td>
                    <% } %>

                      <!-- Highest Bid -->
                      <td class="px-6 py-4">
                        <span class="font-black text-gray-900 dark:text-green-400 text-lg">
                          ₹<%= (prop.currentHighestBid || 0).toLocaleString('en-IN') %>
                        </span>
                        <div class="text-xs text-gray-400 mt-1">
                          Base: ₹<%= prop.basePrice.toLocaleString('en-IN') %>
                        </div>
                      </td>

                      <!-- Winner Details -->
                      <td class="px-6 py-4 max-w-xs">
                        <% if (prop.currentHighestBidder) { %>
                          <div
                            class="p-3 bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-800 rounded-lg">
                            <div class="flex items-center gap-2 mb-2">
                              <span class="material-symbols-outlined text-green-600 text-sm">emoji_events</span>
                              <span
                                class="text-xs font-bold text-green-800 dark:text-green-300 uppercase tracking-wide">Top
                                Bidder</span>
                            </div>
                            <p class="font-bold text-gray-900 dark:text-white">
                              <%= prop.currentHighestBidder.name %>
                            </p>
                            <p class="text-xs text-gray-600 dark:text-gray-400 mt-0.5 break-all">
                              <%= prop.currentHighestBidder.email %>
                            </p>
                            <% if (prop.currentHighestBidder.phone) { %>
                              <p class="text-xs text-gray-600 dark:text-gray-400 mt-0.5">
                                <%= prop.currentHighestBidder.phone %>
                              </p>
                              <% } %>
                          </div>
                          <% } else { %>
                            <span class="text-gray-400 italic text-sm">No bids received yet</span>
                            <% } %>
                      </td>

                      <!-- Status -->
                      <td class="px-6 py-4">
                        <% const now=new Date(); const ends=new Date(prop.auctionEndsAt); const starts=new
                          Date(prop.auctionStartsAt); let badgeClass='' ; let badgeText='' ; if (now> ends) {
                          badgeClass = 'bg-gray-100 text-gray-600 border-gray-200';
                          badgeText = 'Ended';
                          } else if (now >= starts && now <= ends) {
                            badgeClass='bg-red-100 text-red-600 border-red-200 animate-pulse' ; badgeText='Live' ; }
                            else { badgeClass='bg-blue-100 text-blue-600 border-blue-200' ; badgeText='Upcoming' ; } %>
                            <span class="px-2.5 py-1 rounded-full text-xs font-bold border <%= badgeClass %>">
                              <%= badgeText %>
                            </span>
                      </td>

                      <!-- Actions -->
                      <td class="px-6 py-4 text-right">
                        <a href="<%= userRole === 'admin' ? '/admin/reports/view/' + prop._id : '/user/reports/view/' + prop._id %>"
                          class="text-primary hover:text-blue-800 font-semibold text-sm">
                          View Details
                        </a>
                      </td>
                </tr>
                <% }) %>
                  <% } else { %>
                    <tr>
                      <td colspan="<%= userRole === 'admin' ? 6 : 5 %>" class="px-6 py-12 text-center text-gray-500">
                        <span class="material-symbols-outlined text-4xl mb-3 text-gray-300">inbox</span>
                        <p>No auction reports found.</p>
                      </td>
                    </tr>
                    <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </main>
</div>