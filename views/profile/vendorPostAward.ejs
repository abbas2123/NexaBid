<h2 class="text-xl font-bold mb-3">Purchase Order</h2>

<% if (!po) { %>

  <!-- PO NOT CREATED -->
  <div class="p-4 bg-yellow-50 border border-yellow-300 rounded-md">
    <p class="text-yellow-800 font-semibold">
      ‚è≥ Purchase Order has not been created by the publisher yet.
    </p>
    <p class="text-sm text-yellow-700 mt-1">
      Please wait until the publisher issues the Purchase Order.
    </p>
  </div>

<% } else { %>

<% if (isRegenerated) { %>
  <div class="p-4 mb-4 bg-blue-50 border border-blue-300 rounded-md">
    <p class="text-blue-800 font-semibold">
      üîÅ This Purchase Order has been regenerated by the publisher.
    </p>
    <p class="text-sm text-blue-700 mt-1">
      Please review the updated PO carefully before responding.
    </p>
  </div>
<% } %>
  <!-- PO CREATED -->
  <p><strong>PO Number:</strong> <%= po.poNumber || "Not generated" %></p>
  <p><strong>Amount:</strong> ‚Çπ<%= po.amount.toLocaleString("en-IN") %></p>

  <% if (po.pdfFile?.fileUrl) { %>
    <a href="<%= po.pdfFile.fileUrl %>"
       class="text-blue-600 underline"
       target="_blank">
      Download PO
    </a>
  <% } %>

  <hr class="my-4">

  <!-- IF vendor has NOT responded -->
 <% if (["generated", "sent"].includes(po.status)) { %>
    <form method="POST"
          action="/user/vendor/po/<%= po._id %>/respond"
          class="space-y-3">

      <button name="action" value="accept"
        class="bg-green-600 text-white px-4 py-2 rounded-md">
        Accept PO
      </button>

      <button name="action" value="reject"
        class="bg-red-600 text-white px-4 py-2 rounded-md">
        Reject PO
      </button>

      <textarea name="reason"
        placeholder="Reason for rejection (optional)"
        class="w-full mt-3 p-3 border rounded-md"></textarea>
    </form>
  <% } %>

  <!-- IF vendor accepted -->
  <% if (po.status === "vendor_accepted") { %>
    <p class="text-green-600 font-semibold">
      ‚úî You have accepted this Purchase Order.
    </p>
  <% } %>

  <!-- IF vendor rejected -->
  <% if (po.status === "vendor_rejected") { %>
    <p class="text-red-600 font-semibold">
      ‚úñ You rejected this Purchase Order.
    </p>
    <p><strong>Reason:</strong> <%= po.rejectionReason %></p>
  <% } %>

<% } %>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


<script>
  const params = new URLSearchParams(window.location.search);
  const response = params.get("response");
  const error = params.get("error");

  if (response === "accept") {
    Swal.fire("PO Accepted!", "You accepted the purchase order.", "success");
  }

  if (response === "reject") {
    Swal.fire("PO Rejected", "You rejected the purchase order.", "info");
  }

  if (error === "po_not_created") {
    Swal.fire("PO Not Created", "Purchase Order has not been created yet.", "warning");
  }

  if (error === "po_not_accepted") {
    Swal.fire("Action Required", "Please accept the Purchase Order first.", "info");
  }

  if (error === "publisher_agreement_missing") {
    Swal.fire(
      "Agreement Not Available",
      "The publisher has not uploaded the agreement yet. Please wait.",
      "info"
    );
  }

  if (error === "not_winner") {
    Swal.fire("Access Denied", "You are not the winning vendor.", "error");
  }

  if (error === "server_error") {
    Swal.fire("Error", "Something went wrong. Please try again.", "error");
  }
</script>