<body class="font-display bg-background-light dark:bg-background-dark">
  <div class="flex min-h-screen w-full flex-col">
    <!-- MAIN CONTENT -->
    <main class="flex-1 px-4 sm:px-6 md:px-10 lg:px-20 xl:px-40 py-8">
      <div class="max-w-5xl mx-auto flex flex-col">
        <!-- Breadcrumbs -->
        <div class="flex flex-wrap gap-2 text-sm mb-6">
          <a class="text-gray-600 dark:text-gray-400 hover:text-blue-600 transition-colors"
            href="/auth/dashboard">Dashboard</a>
          <span class="text-gray-400">/</span>
          <a class="text-gray-600 dark:text-gray-400 hover:text-blue-600 transition-colors" href="/user/tenders">My
            Tenders</a>
          <span class="text-gray-400">/</span>
          <span class="text-gray-900 dark:text-white font-medium">Create PO</span>
        </div>

        <!-- HEADER -->
        <div class="flex flex-wrap justify-between items-center mb-8">
          <p class="text-[#111418] dark:text-white text-3xl font-bold">Create New Purchase Order</p>
        </div>

        <!-- ðŸŒŸ PO FORM STARTS HERE -->
        <form id="poForm" action="/publisher/tender/<%= tender._id %>/po/generate" method="POST">
          <input type="hidden" name="_csrf" value="<%= csrfToken %>">
          <div class="space-y-8">
            <!-- PO DETAILS -->
            <div class="bg-white dark:bg-background-dark p-6 rounded-xl border shadow-sm">
              <h2 class="text-xl font-bold pb-5 border-b">PO Details</h2>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-6">
                <!-- PO NUMBER -->
                <label class="flex flex-col">
                  <p class="text-sm font-medium pb-2">PO Number</p>
                  <input disabled readonly value="<%= poNumber || 'AUTO-GENERATED' %>"
                    class="form-input rounded-lg bg-gray-50 h-12 text-gray-500 dark:bg-white/5 dark:text-gray-400" />
                </label>

                <!-- ISSUE DATE -->
                <label class="flex flex-col">
                  <p class="text-sm font-medium pb-2">Date of Issue</p>
                  <input type="date" name="issueDate" value="<%= new Date().toISOString().split('T')[0] %>"
                    class="form-input rounded-lg border h-12 bg-white dark:bg-background-dark" />
                </label>
              </div>
            </div>

            <!-- TENDER INFO -->
            <div class="bg-white dark:bg-background-dark p-6 rounded-xl border shadow-sm">
              <h2 class="text-xl font-bold pb-5 border-b">Tender Information</h2>
              <div class="pt-6">
                <label class="flex flex-col">
                  <p class="text-sm font-medium pb-2">Tender Title</p>
                  <input disabled value="<%= tender?.title %>"
                    class="form-input rounded-lg h-12 border bg-gray-50 dark:bg-white/10" />
                </label>
              </div>
            </div>

            <!-- VENDOR -->
            <div class="bg-white dark:bg-background-dark p-6 rounded-xl border shadow-sm">
              <h2 class="text-xl font-bold pb-5 border-b">Winner Vendor Details</h2>

              <div class="grid grid-cols-1 md:grid-cols-2 gap-6 pt-6">
                <label class="flex flex-col">
                  <p class="text-sm font-medium pb-2">Vendor Name</p>
                  <input disabled value="<%= vendor?.name %>"
                    class="form-input rounded-lg h-12 border bg-gray-50 dark:bg-white/10" />
                </label>

                <label class="flex flex-col">
                  <p class="text-sm font-medium pb-2">Email</p>
                  <input disabled value="<%= vendor?.email %>"
                    class="form-input rounded-lg h-12 border bg-gray-50 dark:bg-white/10" />
                </label>
              </div>
            </div>

            <!-- CONTRACT DETAILS -->
            <div class="bg-white dark:bg-background-dark p-6 rounded-xl border shadow-sm">
              <h2 class="text-xl font-bold pb-5 border-b">Contract Details</h2>

              <div class="grid grid-cols-1 md:grid-cols-3 gap-6 pt-6">
                <label class="flex flex-col">
                  <p class="text-sm font-medium pb-2">Contract Amount</p>
                  <input name="amount" type="number" id="amount" value="<%= amount || '' %>"
                    class="form-input rounded-lg h-12 border bg-white dark:bg-background-dark px-4" />
                </label>

                <label class="flex flex-col">
                  <p class="text-sm font-medium pb-2">Start Date</p>
                  <input name="startDate" type="date" id="startDate"
                    class="form-input rounded-lg h-12 border bg-white dark:bg-background-dark px-4" />
                </label>

                <label class="flex flex-col">
                  <p class="text-sm font-medium pb-2">End Date</p>
                  <input name="endDate" type="date" id="endDate"
                    class="form-input rounded-lg h-12 border bg-white dark:bg-background-dark px-4" />
                </label>
              </div>
            </div>

            <!-- TERMS -->
            <div class="bg-white dark:bg-background-dark p-6 rounded-xl border shadow-sm">
              <h2 class="text-xl font-bold pb-5 border-b">Terms & Conditions</h2>

              <label class="flex flex-col pt-6">
                <textarea name="terms" id="terms" rows="6" placeholder="Enter detailed terms and conditions..."
                  class="form-textarea rounded-lg p-4 border bg-white dark:bg-background-dark"></textarea>
              </label>
            </div>
          </div>

          <!-- ACTION BUTTONS -->
          <div class="flex flex-col sm:flex-row justify-end items-center gap-4 mt-10 pt-6 border-t">
            <a href="/publisher/tender/<%= tender._id %>/post-award"
              class="h-12 px-6 rounded-lg bg-gray-100 dark:bg-white/10">
              Cancel
            </a>

            <button type="submit" id="generatePoBtn"
              class="h-12 px-6 rounded-lg bg-primary text-white shadow hover:bg-primary/90">
              Generate PO (PDF)
            </button>
          </div>
        </form>
        <!-- ðŸŒŸ PO FORM ENDS HERE -->

        <!-- SUCCESS MODAL -->
        <% if (showSuccessModal) { %>
          <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 p-4">
            <div class="w-full max-w-md rounded-xl bg-white dark:bg-[#18232f] p-8 text-center shadow-2xl">
              <div
                class="mx-auto h-16 w-16 rounded-full bg-green-200 dark:bg-green-900 flex items-center justify-center">
                <span class="material-symbols-outlined text-4xl text-green-600">task_alt</span>
              </div>

              <h2 class="mt-6 text-2xl font-bold">PO Generated Successfully!</h2>

              <div class="mt-6 flex flex-col sm:flex-row gap-4">
                <a href="/publisher/tender/<%= tender._id %>/po/view"
                  class="h-12 flex items-center justify-center w-full rounded-lg bg-primary/20 text-primary">
                  View PO
                </a>
              </div>
            </div>
          </div>
          <% } %>
      </div>
    </main>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    document.getElementById('poForm').addEventListener('submit', function (e) {
      e.preventDefault();

      const amount = document.getElementById('amount').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const terms = document.getElementById('terms').value;

      if (!amount || amount <= 0) {
        Swal.fire({ icon: 'error', title: 'Validation Error', text: 'Contract Amount is required.' });
        return;
      }
      if (!startDate) {
        Swal.fire({ icon: 'error', title: 'Validation Error', text: 'Start Date is required.' });
        return;
      }
      if (!endDate) {
        Swal.fire({ icon: 'error', title: 'Validation Error', text: 'End Date is required.' });
        return;
      }
      if (new Date(endDate) < new Date(startDate)) {
        Swal.fire({ icon: 'error', title: 'Validation Error', text: 'End Date cannot be earlier than Start Date.' });
        return;
      }
      if (!terms || terms.trim() === '') {
        Swal.fire({ icon: 'error', title: 'Validation Error', text: 'Terms & Conditions are required.' });
        return;
      }

      this.submit();
    });

    // Real-time validation
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');

    function validateDates() {
      const startDate = startDateInput.value;
      const endDate = endDateInput.value;

      if (startDate && endDate) {
        if (new Date(endDate) < new Date(startDate)) {
          Swal.fire({
            icon: 'error',
            title: 'Invalid Date Range',
            text: 'End Date cannot be earlier than Start Date.',
            confirmButtonColor: '#2563eb'
          });
          this.value = ''; // Clear the invalid input
        }
      }
    }

    if (startDateInput) startDateInput.addEventListener('change', validateDates);
    if (endDateInput) endDateInput.addEventListener('change', validateDates);
  </script>
</body>