<!DOCTYPE html>
<html lang="en" class="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= title || "Admin Login - NexaBid" %></title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#0b79e0',
              'background-light': '#f5f7f8',
              'background-dark': '#101922',
            },
            fontFamily: {
              display: ['Public Sans'],
            },
            borderRadius: {
              DEFAULT: '0.25rem',
              lg: '0.5rem',
              xl: '0.75rem',
              full: '9999px',
            },
          },
        },
      };
    </script>
    <script>
      // Disable BFCache on this page (Chrome, Firefox, Safari)
      window.addEventListener('unload', function () {});
    </script>
    <style>
      body {
        font-family: 'Public Sans', sans-serif;
      }
    </style>
  </head>

  <body class="font-display bg-background-light dark:bg-background-dark">
    <!-- Navbar -->
    <header
      class="w-full bg-white dark:bg-background-dark border-b border-slate-200 dark:border-slate-800 px-4 py-4 flex items-center justify-between md:px-8"
    >
      <h1 class="text-2xl font-bold text-slate-900 dark:text-slate-50">NexaBid Admin</h1>

      <!-- Hamburger for mobile -->
      <button id="menuToggle" class="md:hidden text-3xl text-slate-700 dark:text-slate-300">
        ‚ò∞
      </button>

      <!-- Desktop Menu -->
      <nav class="hidden md:flex gap-8 text-slate-700 dark:text-slate-300">
        <a href="/" class="hover:text-primary">Home</a>
        <a href="/contact" class="hover:text-primary">Support</a>
      </nav>
    </header>

    <!-- Mobile Menu -->
    <div
      id="mobileMenu"
      class="hidden md:hidden bg-gray-100 dark:bg-slate-800 p-4 text-center space-y-3"
    >
      <a href="/" class="block hover:text-primary text-slate-700 dark:text-slate-300">Home</a>
      <a href="/contact" class="block hover:text-primary text-slate-700 dark:text-slate-300"
        >Support</a
      >
    </div>

    <!-- Main Login Card -->
    <div class="flex min-h-screen w-full justify-center items-center p-4">
      <div
        class="w-full max-w-md bg-white dark:bg-background-dark border border-slate-200 dark:border-slate-800 rounded-xl p-8 shadow"
      >
        <div class="text-center mb-8">
          <h2 class="text-3xl font-bold text-slate-900 dark:text-white">Administrator Sign In</h2>
          <p class="text-sm text-slate-600 dark:text-slate-400 mt-2">
            Only authorized admins can access the dashboard.
          </p>
        </div>

        <!-- Admin Login Form -->
        <form id="adminLoginForm" class="space-y-6">
          <!-- Email -->
          <div>
            <label class="text-sm font-medium text-slate-800 dark:text-slate-200"
              >Admin Email</label
            >
            <input
              type="email"
              id="email"
              name="email"
              placeholder="Enter admin email"
              class="form-input mt-2 w-full rounded-lg border border-slate-300 bg-white p-3 text-base text-slate-900 placeholder:text-slate-400 focus:border-primary focus:ring-2 focus:ring-primary/20 dark:border-slate-600 dark:bg-slate-800 dark:text-slate-50 dark:placeholder:text-slate-500"
            />
          </div>

          <!-- Password -->
          <div>
            <label class="text-sm font-medium text-slate-800 dark:text-slate-200">Password</label>
            <div class="relative mt-2">
              <input
                type="password"
                id="password"
                name="password"
                placeholder="Enter password"
                class="form-input w-full rounded-lg border border-slate-300 bg-white p-3 pr-12 text-base dark:bg-slate-800 dark:border-slate-600 dark:text-white focus:border-primary focus:ring-2 focus:ring-primary/20"
              />

              <span
                id="togglePassword"
                class="absolute right-3 top-3 cursor-pointer text-slate-500 dark:text-slate-400 text-xl"
                >üëÅÔ∏è</span
              >
            </div>
          </div>

          <!-- Login Button -->
          <button
            type="submit"
            class="w-full bg-primary py-3 rounded-lg text-white font-medium hover:bg-primary/90"
          >
            Login
          </button>
        </form>
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-4 text-xs text-slate-500 dark:text-slate-400">
      ¬© 2024 NexaBid Admin Panel. All Rights Reserved.
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      // Toggle mobile menu
      document.getElementById('menuToggle').addEventListener('click', () => {
        document.getElementById('mobileMenu').classList.toggle('hidden');
      });

      // Password toggle
      const togglePassword = document.getElementById('togglePassword');
      const passwordInput = document.getElementById('password');

      togglePassword.addEventListener('click', () => {
        const type = passwordInput.type === 'password' ? 'text' : 'password';
        passwordInput.type = type;
        togglePassword.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
      });

      document.addEventListener('DOMContentLoaded', () => {
        const form = document.getElementById('adminLoginForm');

        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const email = document.getElementById('email').value.trim();
          const password = document.getElementById('password').value.trim();

          const res = await fetch('/admin/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include', // IMPORTANT
            body: JSON.stringify({ email, password }),
          });

          const data = await res.json();

          if (!data.success) {
            return Swal.fire('Login Failed', data.message, 'error');
          }

          Swal.fire({
            title: 'Success',
            text: data.message,
            icon: 'success',
            timer: 1000,
            showConfirmButton: false,
          });

          setTimeout(() => {
            window.location.replace('/admin/dashboard'); // BEST redirect
          }, 1000);
        });
      });
    </script>
    <script>
      // If admin already logged in ‚Üí redirect to dashboard
      document.addEventListener('DOMContentLoaded', () => {
        if (document.cookie.includes('adminToken=')) {
          window.location.replace('/admin/dashboard');
        }
      });

      // Prevent BFCache from restoring login page
      window.addEventListener('unload', () => {});
    </script>
  </body>
</html>
